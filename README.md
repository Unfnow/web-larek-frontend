# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss— корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Архитектуру проекта формирует паттерн MVP (Model-View-Presenter), который подразумевает разделение проекта на состовные части:

Слой отображения (View) — интерфейс для взаимодействия с пользователем. Его задача — выводить что-то на экран и генерировать события с действиями пользователя.

Слой представления (Presenter), или Слой коммуникации, — для небольших приложений обычно достаточно клиента API для взаимодействия с сервером. Он будет получать данные извне и отправлять их за пределы браузера. Для чуть более сложных приложений вводят слой представления, который соединяет отображение, данные и коммуникацию.

Слой данных (Model) — между сервером и интерфейсом есть данные, в которых отражена вся ценность нашего приложения. Нередко он содержит значительную часть бизнес-логики.

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.

Также ТЗ требует выполнение следующих требований:

Главная страница:
+содержит каталог товаров
+при нажатии на карточку товара открывается модальное окно с детальной информацией о товаре;
+при нажатии на иконку корзины, открывается корзина.
Просмотр товара:
+показана детальная информация о товаре;
+при нажатии на кнопку «Купить» товар добавляется в корзину, если не был добавлен в корзину раньше;
+при нажатии на кнопку «Убрать» товар удаляется из корзины.
Оформление товара:
Первый шаг:
+выбор способа оплаты;
+ввод адреса доставки;
+если адрес доставки не введён, появляется сообщение об ошибке.
Второй шаг:
+ввод почты и телефона покупателя;
+если одно из полей не заполнено, появляется сообщение об ошибке;
+при нажатии на кнопку оплаты появляется сообщение об успешной оплате и -товары удаляются из корзины.
Требования ко всем страницам:
Модальные окна закрываются:
+по клику вне модального окна;
+по клику на иконку «Закрыть» (крестик).
+Кнопка перехода к следующему шагу становится доступна только после выполнения действий на текущей странице (выбора товара, способа оплаты, заполнения данных о покупателе).

# Слой Model

Слой прелставляет собой описание моделей данных, которые используются в приложении. Здесь хранится информация и сохраняется информация, которая необходма в течении всего цикла выполнения программного приложения.

## Класс Model<T>

Базовый класс. Базовая модель, на основе которой создаётся большенство моделей
Методы:
-constructor(data: Partial<T>, protected events: IEvents):void- принимает необязательный Дженерик элемент и Events
-emitChanges(event: string, payload?: object) - Сообщает всем, что модель поменялась

## Класс ProductModel

Наследуется от интерфейса Product. Класс описывает структуру продукта, одного из основных элементов программы.
Поля:

- id: string- Уникальный идентификатор товара
- description: string- Описание товара
- image: string- Ссылка на картинку карточки
- title: string- Название товара
- category: string- Теги, присваемые товару
- price: number- Цена товара
  Методы:
- constructor():void-Конструктор класса получает на вход json объект, полученную с сервера и заполняет поля данными. Конструктор возвращает void

## Класс CartModel

Наследуется от интерфейса Cart. Класс описывает структуру заказа пользователя, который в последствии отправится на сервер.

Поля:
- orders: IProduct[]- Массив продуктов, находящихся в корзине
- cartPrice: number- Сумма заказа

Методы:
- constructor():obj- Инициализирует пустые значения и возвращает объект.
- addToCart(item: IProduct):void- производит проверки и добавляет элемент в корзину
- removeFromCard(item: IProduct):void- Принимает объект и удаляет его из корзины
- priceCount(obj):number- Считает сумму заказа. Возвращает результат типа number Последующим действием она отправляется в слой View где отображается в модальном окне корзины.


# Слой Presenter

Описывает взаимодествие между слоями и сервером. Здесь собрана основная логику приложения.

## Класс AppState

Наследуется от класса Model и интерфейса IAppState. Отвечает за состоаяние приложения

Поля:
- catalog: ProductModel[]- содержит карточки, отображаемые на странице
- order: IOrder & IContacts- содержит информацию о заказе
- preview: string | null- отвечает за изменения отображения карточек
- FormOrderErrors: FormOrderErrors = {}- отвечает за ошибке в первой форме
- FormContactsErrors: FormContactsErrors = {}- отвечает за ошибке во второй форме
Методы:
- addToItems(id:string):void- добавляет элементы из корзины в заказ
- getTotal(cartToltal: number): void- добавляет сумму заказа в заказ
- setPreview(item: ProductModel): void- создаёт событие для открытия карточки на полный экран
- setOrderField( field: keyof IAddressNTypeForm | keyof IContactsForm, value: string):void- принимает данные с форм и создаёт событие, обозночающее готовность заказа
- validateOrder():boolean- принимает форму order на наличие данных
- validateContacts():boolean- принимает форму сщтефсеы на наличие данных

## Класс Api

Отвечает за отправку get и post запросов на сервер

Поля:
- readonly baseUrl: string- базовая ссылка
- protected options: RequestInit- Настройки, необходимые для запросов на сервер

Методы:
- handleResponse(response: Response):json- Создаёт Promise
- get(uri: string):object- выгружает данные с сервера
- post(uri: string, data: object, method: ApiPostMethods = 'POST'):object- загружает данные на сервер

## Класс EventEmitter

Базовый класс. Класс релизует обработчики событий, каждый из которых является Дженерик типом, что позволят гибко использовать методы. Реализует паттерн observer.
Методы:

- constructor():void- Инициализирует переменные.Ничего не получает и ничего не возвращает.
- on<T extends object>(eventName: EventName, callback: (event: T) => void):void- установает обработчик на событие.
- off(eventName: EventName, callback: Subscriber):void- снимает обработчик с события
- emit<T extends object>(eventName: string, data?: T):void- инициализирует событие с данными
- onAll(callback: (event: EmitterEvent) => void):void- устанавливает слушатель всех событий
- offAll()- сбрасывает все обработчики
- trigger<T extends object>(eventName: string, context?: Partial<T>):void- генерирует заданное событие с заданными аргументами


# Слой View

Слой отображения данных, интерфейс приложения. Здесь представлены все классы и методы не имеющие отношения к логике приложения, но зато, описывает работу модальных окон и взаимодействия с ними пользователя

## Класс Component

Базовый класс отображения. Абстрактный базовый класс, предназначенным для создания компонентов пользовательского интерфейса. Класс обеспечивает инструментарий для управления DOM элементами и поведением компонента. Наследуется всеми классами представления(View)
Методы:

- constructor(protected readonly container: HTMLElement):void- принимает контейнер с HTML-кодом
- toggleClass(element: HTMLElement, className: string, force?: boolean):void- переключает класс. принимает HTML-код, название класса и значение токена force.
- setText(element: HTMLElement, value: unknown):void- установливает текстовое содержимое. Принимает HTML-код и выводимый текст.
- setDisabled(element: HTMLElement, state: boolean):void- меняет статус блокировки. Принимает HTML-код и значение токена force.
- setHidden(element: HTMLElement):void- скрывает элемент. Принимает HTML-код
- setVisible(element: HTMLElement):void- показывает элемент. Принимает HTML-код
- setImage(element: HTMLImageElement, src: string, alt?: string):void- установает изображение с алтернативным текстом. Принимает HTML-код, ссылку на изображение и альтернативную подпись к картинке
- render(data?: Partial<T>): HTMLElement- принимает необязательный тип. находит HTML-элемент возвращает контейнер

## Класс Modal

Наследник класса Component. Описывает взаимодействие с модальными окнами.
Поля:
- closeButton- кнопка закрытия окна
- content- содержимое окна
Методы:
- constructor(prod:obj):void- инициализирует данные
- open(popup: string):void- открывает модальное окно
- close(popup: string):void- закрывает модальное окно
- render(data: IModalData): HTMLElement- создаёт HtmlElement и возвращает его

## Класс Card

Наследник класса Modal. Этот класс описывает создание карточки и методы взаимодействия с ней.
Методы:

- constructor([obj]):void-получает массив объектов товаров и для каждого из них отрисовывает карточку на интерфесе сайта. Возвращает void.
- addToCart():void- Проверяет, есть ли товар в корзине и если нет, то добавляет товар в корзину

## Класс CartIcon

Базовый класс. Отображает иконку корзины. Считает их кол-во и отображает на иконке. Если корзина пустая- то число не будет выводиться.
Методы:

- constructor([obj]):void- Конструткор принимает на вход массив товаров в виде массива объектов
- cartValueCheck(sum:number):void- метод получает на вход сумму цены товаров и проверяет её на ноль и либо выводит число на иконку, либо отрисовывает иконку без цифры. Вызывается событием изменения поля cartPrice класса CartModel

## Класс Backet

Наследник класса Modal. Отрисовывает модальное окно коризины. Открывается при нажатии на иконку корзины. Отображает список добавленных товаров, убрать товары из корзины, а также по нажатию кнопки, позволяет перейти к оформлению заказа.
Методы:

- constructor(cart:obj):void- принимает экземпляр класса CartModel. Возвращает void.
- deleteCart(elem:obj)- принимает товар в виде объекта и удалаяет его из корзины. Перерисовывает интерфейс модального окна. После этого вызывается метод , меняющий данные класса CartModal
- toPay()- открывает форму для ввода персональных данных.

## Класс addressNType

Наследник класса Modal. Класс описывает первую форму, которая открывается после нажатия "Далее" намодальном окне корзины. Наследуется от класса Modal. Заполняя любой элемент формы или при попытке нажать на кнопку, сработает событие on и будут вызываться проверки паттерна класса authForm

- topDescription: string- описание верхней строки
- topinput: input- значение верхней строки
- bottomDescription: string- описание нижней строки
- bottominput: input- значение нижней строки
  Методы:
- constructor(form: BaseForm):void- Конструктор принимает интерфейс BaseForm и заполнеяет его. Возвращает void.
- nextForm(verdict: boolean):void- Принимает результат проверок. Если все проверки класса authForm вернули true, то при нажатии откроется следующая форма

## Класс Contacts

Наследник класса Modal и интерфейса BaseForm. Класс описывает вторую форму, которая открывается после нажатия "Оплатить" намодальном окне корзины. Наследуется от класса Modal. Заполняя любой элемент формы или при попытке нажать на кнопку, сработает событие on и будут вызываться проверки паттерна класса authForm

- topDescription: string- описание верхней строки
- topinput: input- значение верхней строки
- bottomDescription: string- описание нижней строки
- bottominput: input- значение нижней строки
  Методы:
- constructor(form: BaseForm):void- Конструктор принимает интерфейс BaseForm и заполнеяет его. Возвращает void.
- nextForm(verdict: boolean):void- Принимает результат проверок. Если все проверки класса authForm вернули true, то при нажатии откроется следующая форма

## Класс Success

Наследник класса Component и интерфейса ISuccess. Конструктор класса выводит картинку и надпись об успешной оплате товара. 
Методы:

- constructor(container: HTMLElement, cartPrice:number, actions: ISuccessActions):void- Принимает контейнер, action, а также сумму заказа. Отображает модальное окно. Возвращает void.

# Интерфейсы

## Интерфейс BaseForm

Интерфейс заготовки для формы. Используется для классов addressNTypeForm и MailNPhoneForm.
Поля:

- topDescription: string- описание верхней строки
- topinput: input- значение верхней строки
- bottomDescription: string- описание нижней строки
- bottominput: input- значение нижней строки

## Интерфейс IProduct

Интерфейс для заготовки товара. Используется классом ProductModel.
Поля:

- id: string- Уникальный идентификатор товара
- description: string- Описание товара
- image: string- Ссылка на картинку карточки
- title: string- Название товара
- category: string- Теги, присваемые товару
- price: number- Цена товара

## Интерфейс ICart

Интерфейс для заготовки корзины. Используется классом CartModel.
Поля:

- orders: [obj]- Массив продуктов, находящихся в корзине
- cartPrice: number- Сумма заказа
- payType: (card|cash)- Тип оплаты
- useraddress: string- адрес заказчика
- userPhone: string- контактный телефон заказчика
- userMail: string- эл. почта заказчика

# Ключевые типы данных

- typeOfOrder= 'card'|'cash' / Тип оплаты заказа
- elems= [obj] / Массив товаров
- elem= obj / Конкретный товар из массива


## События
- contacts:submit- данные формы отправлены
- order:submit- данные формы отправлены
- FormContactsErrors:change- данные об ошибках на форме изменены
- FormOrderErrors:change- данные об ошибках на форме изменены
- order:open- форма заказа открыта
- payMethod:card- тип оплаты- онлайн
- payMethod:change- тип оплаты изменён
- payMethod:cash- тип оплаты- наличные
- basket:changed- в корзину добавили элемент
- basket:removed- элемент корзины удалён
- backet:clear- корзина пуста
- card:select- карточка выбрана
- preview:changed- карточка открыта
- modal:close- закрыто модальное окно
- modal:open- открыто модальное окно

# Ещё об архитектуре

Паттерн MVP позволяет разделять логику работы приложения на слои и гибко взаимодействовать между ними. Таким образом необходимые данные хранятся каждая в своей модели Model. Всё что связано с интерфейсом: модальные окна и взаимодейсвия с ними, формы и кнопки находятся в отображении View. А логика взаимодействия между первыми двумя слоями и API описана в представителе Presentir.

Также стоит добавить, что какие-то части документации будут меняться в процессе разработки, так как, при реализации вывявляются ошибки текущий документации и идеи её изменения.
