# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss— корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Архитектуру проекта формирует паттерн MVP (Model-View-Presenter), который подразумевает разделение проекта на состовные части:

Слой отображения (View) — интерфейс для взаимодействия с пользователем. Его задача — выводить что-то на экран и генерировать события с действиями пользователя.

Слой представления (Presenter), или Слой коммуникации, — для небольших приложений обычно достаточно клиента API для взаимодействия с сервером. Он будет получать данные извне и отправлять их за пределы браузера. Для чуть более сложных приложений вводят слой представления, который соединяет отображение, данные и коммуникацию.

Слой данных (Model) — между сервером и интерфейсом есть данные, в которых отражена вся ценность нашего приложения. Нередко он содержит значительную часть бизнес-логики.


Также ТЗ требует выполнение следующих требований:

Главная страница: 
+содержит каталог товаров 
+при нажатии на карточку товара открывается модальное окно с детальной информацией о товаре;
+при нажатии на иконку корзины, открывается корзина.
Просмотр товара: 
+показана детальная информация о товаре;
+при нажатии на кнопку «Купить» товар добавляется в корзину, если не был добавлен в корзину раньше;
+при нажатии на кнопку «Убрать» товар удаляется из корзины.
Оформление товара: 
Первый шаг: 
+выбор способа оплаты;
+ввод адреса доставки;
+если адрес доставки не введён, появляется сообщение об ошибке.
Второй шаг: 
+ввод почты и телефона покупателя;
+если одно из полей не заполнено, появляется сообщение об ошибке;
+при нажатии на кнопку оплаты появляется сообщение об успешной оплате и -товары удаляются из корзины.
Требования ко всем страницам:
Модальные окна закрываются: 
+по клику вне модального окна;
+по клику на иконку «Закрыть» (крестик).
+Кнопка перехода к следующему шагу становится доступна только после выполнения действий на текущей странице (выбора товара, способа оплаты, заполнения данных о покупателе).

# Слой Model
Слой прелставляет собой описание моделей данных, которые используются в приложении. Здесь хранится информация и сохраняется информация, которая необходма в течении всего цикла выполнения программного приложения. 

## Класс ProductModel
Класс описывает структуру продукта, одного из основных элементов программы. Конструктор класса получает на вход json строку, полученную с сервера, в формате string и заполняет поля данными. Конструктор возвращает void
Поля:
+ id: string- Уникальный идентификатор товара
+ description: string- Описание товара
+ image: string- Ссылка на картинку карточки
+ title: string- Название товара
+ category: string- Теги, присваемые товару
+ price: number- Цена товара

## Класс CartModel
Класс описывает структуру заказа пользователя, который в последствии отправится на сервер. Конструктор инициализирует пустые значения и возвращает объект. Класс является абстрактным, поэтому везде где он вызывается, используется один и тот же экземпляр
Поля:
+ orders: [obj]- Массив продуктов, находящихся в корзине
+ cartPrice: number- Сумма заказа
+ payType: (online|upon_receipt)- Тип оплаты
+ userAdress: string- адрес заказчика
+ userPhone: string- контактный телефон заказчика
+ userMail: string- эл. почта заказчика
Методы:
+ priceCount(obj): number- Считает сумму заказа. Возвращает результат типа number Последующим действием она отправляется в слой View где отображается в модальном окне корзины.


# Слой Presenter
Описывает взаимодествие между слоями и сервером. Здесь собрана основная логику приложения. 

## Класс API
Описывает взаимодействие с сервером при помощи метордов Post и Get. После запроса на сервер вызывает защищённой метод handleResponse, в котором производится проверка запроса и конверация запроса в json. Конструктор класса получает адрес корневой директории и настройки, который передаётся в теле заказа. Конструктор возвращает void.
Методы:
+ handleResponse(response: Response)-
+ get(uri: string)- Метод реализует get-запрос, принимает на вход путь к катологу на сервере, откуда будут браться данные
+ post(uri: string, data: object, method: ApiPostMethods = 'POST')- Метод реализует post-запрос, принимает на вход путь к катологу на сервере, куда отправятся данные; Тело запроса, содержащее отправляемые данные, а также настройки; И тип запроса, а именно Post.

## Класс DataManager
Отправляет, при помощи класса Api, Get-запрос на сервер и получает список товаров, после чего создаёт для каждого элемента списка экземпляр класса  ProductModel. Конструктор принимает путь к директории в виде строки, откуда будут забираться данные и возвращает массив объектов.
Методы:
+ dataFetcher(uri: string)- создаёт get-запрос для получения данных с сервера, получает на вход путь к директории. Возвращает json в виде объекта
+ dataParcer(elems:[obj])- переносит данные с сервера в память приложения при помощи создания экземпляра класса ProductModel для каждого товара. Принимет массив объектов json. Возвращает void.
Поля:
+ direction: string- путь к директории в виде строки

## Класс OrderManager
Вносит изменения в класс CartModel. Удаляет элементы из корзины, отправляет post-запросы заказов на сервер и очищает её после отправки запроса, если он успешен
Методы:
+ cartDelete(elem:obj)- Принимает на вход объект и удаляет его из корзины.
+ cartClear()- очищает данные всех полей экземпляра класса.
+ orderPost(elem:obj, uri: string)- Отправляет заказ на сервер в виде post-запроса при помощи метода post() класса API. Принимает два параметра: экземпляр класса CartModel и путь к директории, куда необходимо отправить данные

## Класс EventEmitter
Класс релизует обработчики событий, каждый из которых является Дженерик типом, что позволят гибко использовать методы. Реализует паттерн observer.
Методы:
+ on<T extends object>(eventName: EventName, callback: (event: T) => void)- установает обработчик на событие.
+ off(eventName: EventName, callback: Subscriber)- снимает обработчик с события
+ emit<T extends object>(eventName: string, data?: T)- инициализирует событие с данными
+ onAll(callback: (event: EmitterEvent) => void)- устанавливает слушатель всех событий
+ offAll()- сбрасывает все обработчики
+ trigger<T extends object>(eventName: string, context?: Partial<T>)- генерирует заданное событие с заданными аргументами

## Класс authForm
Класс описывающий логику обработки форм. Не позволяет нажать на кнопку "Далее"/"Оплатить", если поля не заполнены, а также сверяет вводимые данные с паттерном
Методы:
+ patternPhoneCheck(input: input)- метод проверяет вводимые данные и сверяет их с паттерном телефонного номера. Принимает input, возвращает boolean
+ patternMailCheck(input: input)- метод проверяет вводимые данные и сверяет их с паттерном почты номера. Принимает input, возвращает boolean
+ fillcheck(topInput: input, bottomInput: input)- метод проверяет заполнены ли оба поле перед нажатием на кнопку. Принимает обе строкиформы типа input, возвращает boolean
+ showError<error:T,place:K>- метод, отображающий ошибку, если проверка не пройдена. Это дженерик метод. Он принимает два значаения- сообщение об ошибке error типа T и местно где небходимо отобразить ошибку place типа K. Вызывается из методов проверок.
+ approveButton(topInput: input, bottomInput: input)- обработчик нажатия кнопки "Далее"/"Оплатить", записывает данные в экземпляр класса OrderManager. Принимает обе строкиформы типа input, возвращает boolean

# Слой View
Слой отображения данных, интерфейс приложения. Здесь представлены все классы и методы не имеющие отношения к логике приложения, но зато, описывает работу модальных окон и взаимодействия с ними пользователя

## Класс Card
Этот класс описывает создание карточки и методы взаимодействия с ней. Конструктор получает массив объектов товаров и для каждого из них отрисовывает карточку на интерфесе сайта. Возвращает void.
Методы:
+ createModal(elem:obj)- при помощи класса Modal создаёт модальное окно для карточки. Вызывается в теле конструктора. Принимает экземпляр класса ProductModel
+ addToCart()- Проверяет, есть ли товар в корзине и если нет, то добавляет товар в корзину

## Класс Modal
Описывает взаимодействие с модальными окнами. Конструктор принимает экземпляр класса ProductModel и создаёт модальное окно, заполняя его данными.
Методы:
+ openModal(popup: string)-  реализует открытие модального окна при помощи обработчика события on класса EventEmitter
+ closeModal(popup: string)- реализует закрытие модального окна при помощи обработчика события on класса EventEmitter при нажатии на кнопку закрытия
+ closeModalbyESC(popup: string)- реализует закрытие модального окна при помощи обработчика события on класса EventEmitter при нажатии на клавишу ESC
+ closeOverlay(popup: string)- реализует закрытие модального окна при помощи обработчика события on класса EventEmitter при нажаие на пустое пространство

## Класс CartIcon
Отображает иконку корзины. Конструткор принимает на вход массив товаров в виде массива объектов. Считает их кол-во и отображает на иконке. Если корзина пустая- то число не будет выводиться.
Методы:
+ cartValueCheck(sum:number)- метод получает на вход сумму цены товаров и проверяет её на ноль и либо выводит число на иконку, либо отрисовывает иконку без цифры. Вызывается событием изменения поля cartPrice класса CartModel
+ createModal(elem:obj)- при помощи класса Modal создаёт модальное окно для карточки. Вызывается в теле конструктора. Принимает экземпляр класса CartModel

## Класс CartModal
Отрисовывает модальное окно коризины. Наследуется от класса Modal, добавляя новые методы. Открывается при нажатии на иконку корзины. Отображает список добавленных товаров, убрать товары из корзины, а также по нажатию кнопки, позволяет перейти к оформлению заказа. Конструктор принимает экземпляр класса CartModel. Возвращает void.
Методы:
+ deleteCart(elem:obj)- принимает товар в виде объекта и удалаяет его из корзины. Перерисовывает интерфейс модального окна. После этого вызывается метод , меняющий данные класса CartModal
+ toPay()- открывает форму для ввода персональных данных.

## Класс AdressNTypeForm
Класс описывает первую форму, которая открывается после нажатия "Далее" намодальном окне корзины. Наследуется от класса Modal. Конструктор принимает интерфейс BaseForm и заполнеяет его. Заполняя любой элемент формы или при попытке нажать на кнопку, сработает событие on и будут вызываться проверки паттерна класса authForm
+ topDescription: string- описание верхней строки
+ topinput: input- значение верхней строки
+ bottomDescription: string- описание нижней строки
+ bottominput: input- значение нижней строки
Методы:
+ nextForm()- Если все проверки класса authForm вернули true, то при нажатии откроется следующая форма
## Класс MailNPhoneForm
Класс описывает вторую форму, которая открывается после нажатия "Оплатить" намодальном окне корзины. Наследуется от класса Modal. Конструктор принимает интерфейс BaseForm и заполнеяет его. Заполняя любой элемент формы или при попытке нажать на кнопку, сработает событие on и будут вызываться проверки паттерна класса authForm
+ topDescription: string- описание верхней строки
+ topinput: input- значение верхней строки
+ bottomDescription: string- описание нижней строки
+ bottominput: input- значение нижней строки
Методы:
+ nextForm()- Если все проверки класса authForm вернули true, то при нажатии откроется следующая форма

## Класс SuccessForm
Конструктор класса выводит картинку и надпись об успешной оплате товара. Класс наследуется от класса Modal и при вызове единственной кнопки использует тот же функционал, что и при нажатии на "крестик". После этого метод orderPost() класса OrderManager делает post-запрос на сервер и при успешном действии вызывает метод cartClear(), который очищает корзину.

# Интерфейсы

## Интерфейс BaseForm
Интерфейс заготовки для формы. Используется для классов AdressNTypeForm и MailNPhoneForm.
Поля:
+ topDescription: string- описание верхней строки
+ topinput: input- значение верхней строки
+ bottomDescription: string- описание нижней строки
+ bottominput: input- значение нижней строки